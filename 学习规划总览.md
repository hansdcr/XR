# visionOS 房间设计器 - 学习规划总览

## 项目简介

本项目通过逐步迭代的方式，学习 visionOS 开发，最终实现一个完整的房间设计器应用。该应用可以：
- 扫描房间并构建3D模型
- 在房间中放置和管理3D物体
- 检测平面和墙面
- 使用空间锚点保存物体位置
- 支持手势操作和眼动交互

## 参考项目分析

**项目名称**: BuildingLocalExperiencesWithRoomTracking

**核心技术栈**:
- ARKit (ARKitSession, WorldTrackingProvider, RoomTrackingProvider)
- RealityKit (RealityView, ModelEntity, AnchorEntity)
- SwiftUI (WindowGroup, ImmersiveSpace)
- 空间手势 (SpatialTapGesture)
- 空间锚点 (WorldAnchor, RoomAnchor)

**主要功能模块**:
1. 房间扫描与跟踪
2. 3D物体放置与管理
3. 空间锚点系统
4. 平面检测与墙面识别
5. 遮挡可视化
6. 射线投射检测

## 学习目标

通过本规划，你将掌握：
1. visionOS 基础架构（App、Scene、View）
2. SwiftUI 在 visionOS 中的应用
3. 沉浸式空间的创建与管理
4. ARKit 房间跟踪与世界跟踪
5. RealityKit 3D 渲染与交互
6. 空间手势处理
7. 空间锚点的使用
8. 平面和墙面检测
9. 状态管理与数据流

## 学习策略

### 1. 递进式学习
从最简单的功能开始，逐步增加复杂度：
- 阶段1: 基础架构（窗口和空间）
- 阶段2: 简单3D内容（静态物体）
- 阶段3: ARKit 集成（世界跟踪）
- 阶段4: 交互功能（手势和放置）
- 阶段5: 房间跟踪（房间检测）
- 阶段6: 高级功能（墙面检测、遮挡）

### 2. 小步迭代
- 每次最多创建一个文件
- 每次最多实现一个方法
- 每个方法代码量不超过50行
- 每次迭代可运行和测试

### 3. 结对编程
- 每完成一个迭代，一起回顾代码
- 讨论下一步的实现方向
- 解决遇到的问题
- 确保理解每一行代码

## 迭代总览

### 阶段1: 基础架构 (迭代 1-5)
创建最基本的 visionOS 应用结构
- App 入口
- 主窗口视图
- 沉浸式空间
- 状态管理基础
- 空间切换

### 阶段2: 静态3D内容 (迭代 6-10)
学习 RealityKit 基础，显示简单3D物体
- RealityView 基础
- 创建简单3D球体
- 添加材质和颜色
- 多个物体管理
- 物体层级结构

### 阶段3: ARKit 世界跟踪 (迭代 11-15)
引入 ARKit，实现世界坐标系跟踪
- ARKitSession 初始化
- WorldTrackingProvider 设置
- 设备位置跟踪
- 世界锚点创建
- 锚点更新处理

### 阶段4: 交互与放置 (迭代 16-22)
实现用户交互，允许放置物体
- 预览球体（头部锚定）
- 空间点击手势
- 物体放置逻辑
- 物体选择
- 物体删除
- 多物体管理
- 物体移动

### 阶段5: 房间跟踪 (迭代 23-28)
集成房间跟踪功能
- RoomTrackingProvider 设置
- 房间锚点处理
- 房间边界检测
- 物体房间归属
- 房间切换处理
- 多房间支持

### 阶段6: 高级功能 (迭代 29-35)
实现高级空间功能
- 墙面几何提取
- 射线投射检测
- 墙面选择与渲染
- 遮挡材质应用
- 平面检测
- 物体墙面吸附
- 碰撞检测

### 阶段7: 优化与完善 (迭代 36-40)
优化用户体验
- 错误处理
- 权限管理
- UI 优化
- 性能优化
- 持久化（如果需要）

## 关键学习点

### visionOS 特有概念
1. **ImmersiveSpace**: 沉浸式空间，不同于传统窗口
2. **@Observable**: Swift 新的状态管理方式（替代 ObservableObject）
3. **@MainActor**: 确保 UI 操作在主线程
4. **RealityView**: visionOS 专用的 3D 内容容器

### ARKit for visionOS
1. **ARKitSession**: 管理 AR 会话，不同于 iOS 的 ARSession
2. **WorldTrackingProvider**: 提供世界坐标系跟踪
3. **RoomTrackingProvider**: visionOS 特有的房间跟踪
4. **WorldAnchor/RoomAnchor**: visionOS 的锚点系统

### RealityKit 基础
1. **Entity 层级**: 场景图结构
2. **Component 系统**: ECS 架构（Entity-Component-System）
3. **材质系统**: SimpleMaterial, OcclusionMaterial, UnlitMaterial
4. **手势处理**: 空间手势与实体交互

## 开发环境要求

- Xcode 15.2+
- visionOS SDK
- Vision Pro 模拟器或真机
- macOS Sonoma 14.0+

## 权限要求

应用需要以下权限：
- World Sensing（必需）

在 Info.plist 中配置：
```xml
<key>NSWorldSensingUsageDescription</key>
<string>需要扫描房间以放置虚拟内容</string>
```

## 学习资源

### Apple 官方文档
- [visionOS Developer Documentation](https://developer.apple.com/visionos/)
- [ARKit for visionOS](https://developer.apple.com/documentation/arkit)
- [RealityKit Documentation](https://developer.apple.com/documentation/realitykit)
- [SwiftUI for visionOS](https://developer.apple.com/documentation/swiftui)

### 示例代码
- BuildingLocalExperiencesWithRoomTracking（本项目参考）
- Apple Sample Code Gallery

## 注意事项

### visionOS vs iOS
visionOS 的很多 API 与 iOS 有差异，需要特别注意：
- ❌ iOS 的 ARSession → ✅ visionOS 的 ARKitSession
- ❌ iOS 的 ARWorldTrackingConfiguration → ✅ visionOS 的 WorldTrackingProvider
- ❌ iOS 的 ARAnchor → ✅ visionOS 的 WorldAnchor/RoomAnchor
- ❌ @StateObject/@ObservedObject → ✅ @Observable + @State

### 代码规范
- 保持方法简短（< 50 行）
- 单一职责原则
- 清晰的命名
- 适当的注释

### 测试策略
- 每次迭代后测试功能
- 使用模拟器（部分功能）
- 真机测试（完整功能）

## 下一步

请查看 `迭代计划详解.md` 文档，开始第一个迭代的学习。

---

**创建时间**: 2025-10-27
**版本**: 1.0
**作者**: Claude Code

# visionOS æˆ¿é—´è®¾è®¡å™¨ - è¿­ä»£è®¡åˆ’è¯¦è§£

## å¦‚ä½•ä½¿ç”¨æœ¬æ–‡æ¡£

æ¯ä¸ªè¿­ä»£åŒ…å«ï¼š
- **ç›®æ ‡**: æœ¬æ¬¡è¿­ä»£è¦å®ç°çš„åŠŸèƒ½
- **æ–°å»º/ä¿®æ”¹æ–‡ä»¶**: æ¶‰åŠçš„æ–‡ä»¶
- **æ–¹æ³•åˆ—è¡¨**: è¦å®ç°çš„æ–¹æ³•ï¼ˆæŒ‰é¡ºåºï¼‰
- **ä»£ç è¦ç‚¹**: å…³é”®ä»£ç ç‰‡æ®µå’Œè¯´æ˜
- **æµ‹è¯•éªŒè¯**: å¦‚ä½•éªŒè¯åŠŸèƒ½æ­£ç¡®
- **å­¦ä¹ é‡ç‚¹**: æœ¬è¿­ä»£çš„å…³é”®çŸ¥è¯†ç‚¹

æ¯å®Œæˆä¸€ä¸ªè¿­ä»£ï¼Œå»ºè®®ï¼š
1. è¿è¡Œå¹¶æµ‹è¯•ä»£ç 
2. ç†è§£æ¯ä¸€è¡Œä»£ç çš„ä½œç”¨
3. ä¸ Claude è®¨è®ºé‡åˆ°çš„é—®é¢˜
4. åœ¨ç†è§£é€å½»åå†è¿›è¡Œä¸‹ä¸€ä¸ªè¿­ä»£

---

# é˜¶æ®µ1: åŸºç¡€æ¶æ„

## è¿­ä»£ 1: åˆ›å»ºé¡¹ç›®åŸºç¡€ç»“æ„

### ç›®æ ‡
åˆ›å»º visionOS åº”ç”¨çš„å…¥å£ç‚¹ï¼Œè®¾ç½®åŸºæœ¬çš„ App ç»“æ„

### æ–°å»ºæ–‡ä»¶
- `RoomDesignerApp.swift`

### æ–¹æ³•åˆ—è¡¨
1. `RoomDesignerApp.body` - App çš„ä¸»ä½“ç»“æ„

### ä»£ç è¦ç‚¹

**RoomDesignerApp.swift**:
```swift
import SwiftUI

@main
struct RoomDesignerApp: App {
    var body: some Scene {
        WindowGroup {
            Text("Room Designer")
                .font(.title)
        }
    }
}
```

### æµ‹è¯•éªŒè¯
- è¿è¡Œåº”ç”¨ï¼Œçœ‹åˆ°ä¸€ä¸ªçª—å£æ˜¾ç¤º "Room Designer"

### å­¦ä¹ é‡ç‚¹
- `@main` æ ‡è®°åº”ç”¨å…¥å£ç‚¹
- visionOS çš„ `App` åè®®
- `WindowGroup` åœºæ™¯ç±»å‹
- visionOS åº”ç”¨æœ€åŸºæœ¬çš„ç»“æ„

---

## è¿­ä»£ 2: åˆ›å»ºä¸»è§†å›¾

### ç›®æ ‡
åˆ›å»ºä¸»è§†å›¾ï¼Œä¸ºåç»­åŠŸèƒ½é¢„ç•™ UI ç»“æ„

### æ–°å»ºæ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. `ContentView.body` - ä¸»è§†å›¾å¸ƒå±€

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
import SwiftUI

struct ContentView: View {
    var body: some View {
        VStack(spacing: 20) {
            Text("æˆ¿é—´è®¾è®¡å™¨")
                .font(.largeTitle)

            Text("å‡†å¤‡å¼€å§‹")
                .font(.headline)
                .foregroundStyle(.secondary)
        }
        .padding()
    }
}
```

**æ›´æ–° RoomDesignerApp.swift**:
```swift
WindowGroup {
    ContentView()
}
```

### æµ‹è¯•éªŒè¯
- çœ‹åˆ°å¸¦æœ‰æ ‡é¢˜å’Œå‰¯æ ‡é¢˜çš„ç•Œé¢

### å­¦ä¹ é‡ç‚¹
- SwiftUI åŸºç¡€å¸ƒå±€ï¼ˆVStackï¼‰
- visionOS çš„æ–‡å­—æ ·å¼
- View åè®®

---

## è¿­ä»£ 3: æ·»åŠ çŠ¶æ€ç®¡ç†ç±»

### ç›®æ ‡
åˆ›å»ºåº”ç”¨çš„çŠ¶æ€ç®¡ç†ç±»ï¼Œä¸ºåç»­åŠŸèƒ½æä¾›æ•°æ®æ”¯æŒ

### æ–°å»ºæ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `AppState` ç±»å®šä¹‰
2. `init()` - åˆå§‹åŒ–æ–¹æ³•

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
import Foundation
import Observation

@Observable
@MainActor
class AppState {
    // æ˜¯å¦åœ¨æ²‰æµ¸å¼ç©ºé—´ä¸­
    var isImmersive = false

    init() {
        print("AppState initialized")
    }
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- `@Observable` å®ï¼ˆSwift 5.9+ æ–°ç‰¹æ€§ï¼‰
- `@MainActor` ç¡®ä¿çº¿ç¨‹å®‰å…¨
- visionOS çš„çŠ¶æ€ç®¡ç†æ¨¡å¼

---

## è¿­ä»£ 4: å°†çŠ¶æ€æ³¨å…¥è§†å›¾

### ç›®æ ‡
å°† AppState è¿æ¥åˆ°è§†å›¾å±‚ï¼Œå»ºç«‹æ•°æ®æµ

### ä¿®æ”¹æ–‡ä»¶
- `RoomDesignerApp.swift`
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
æ— æ–°æ–¹æ³•ï¼ˆä¿®æ”¹ç°æœ‰ä»£ç ï¼‰

### ä»£ç è¦ç‚¹

**RoomDesignerApp.swift**:
```swift
@main
struct RoomDesignerApp: App {
    @State private var appState = AppState()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environment(appState)
        }
    }
}
```

**ContentView.swift**:
```swift
struct ContentView: View {
    @Environment(AppState.self) private var appState

    var body: some View {
        VStack(spacing: 20) {
            Text("æˆ¿é—´è®¾è®¡å™¨")
                .font(.largeTitle)

            // æ˜¾ç¤ºå½“å‰çŠ¶æ€
            Text(appState.isImmersive ? "æ²‰æµ¸æ¨¡å¼" : "çª—å£æ¨¡å¼")
                .font(.headline)
                .foregroundStyle(.secondary)
        }
        .padding()
    }
}
```

### æµ‹è¯•éªŒè¯
- ç•Œé¢æ˜¾ç¤º "çª—å£æ¨¡å¼"

### å­¦ä¹ é‡ç‚¹
- `@State` åœ¨ App å±‚çš„ä½¿ç”¨
- `.environment()` ä¼ é€’æ•°æ®
- `@Environment` æ¥æ”¶æ•°æ®
- visionOS çš„æ•°æ®æµæ¨¡å¼

---

## è¿­ä»£ 5: æ·»åŠ æ²‰æµ¸å¼ç©ºé—´å®šä¹‰

### ç›®æ ‡
æ·»åŠ æ²‰æµ¸å¼ç©ºé—´åœºæ™¯ï¼Œä¸º 3D å†…å®¹åšå‡†å¤‡

### æ–°å»ºæ–‡ä»¶
- `ImmersiveView.swift`

### ä¿®æ”¹æ–‡ä»¶
- `RoomDesignerApp.swift`

### æ–¹æ³•åˆ—è¡¨
1. `ImmersiveView.body` - æ²‰æµ¸å¼è§†å›¾ï¼ˆæš‚æ—¶ä¸ºç©ºï¼‰

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
import SwiftUI

struct ImmersiveView: View {
    @Environment(AppState.self) private var appState

    var body: some View {
        Text("æ²‰æµ¸å¼ç©ºé—´")
            .font(.title)
    }
}
```

**RoomDesignerApp.swift**:
```swift
@main
struct RoomDesignerApp: App {
    @State private var appState = AppState()

    var body: some Scene {
        WindowGroup {
            ContentView()
                .environment(appState)
        }

        ImmersiveSpace(id: "ImmersiveSpace") {
            ImmersiveView()
                .environment(appState)
        }
    }
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- `ImmersiveSpace` åœºæ™¯ç±»å‹
- æ²‰æµ¸å¼ç©ºé—´çš„ ID æ ‡è¯†
- å¤šåœºæ™¯åº”ç”¨ç»“æ„

---

## è¿­ä»£ 6: æ·»åŠ è¿›å…¥æ²‰æµ¸å¼ç©ºé—´çš„æŒ‰é’®

### ç›®æ ‡
å®ç°çª—å£å’Œæ²‰æµ¸å¼ç©ºé—´ä¹‹é—´çš„åˆ‡æ¢

### ä¿®æ”¹æ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. `openImmersiveSpace()` - æ‰“å¼€æ²‰æµ¸å¼ç©ºé—´
2. `closeImmersiveSpace()` - å…³é—­æ²‰æµ¸å¼ç©ºé—´

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
import SwiftUI

struct ContentView: View {
    @Environment(AppState.self) private var appState
    @Environment(\.openImmersiveSpace) private var openImmersiveSpace
    @Environment(\.dismissImmersiveSpace) private var dismissImmersiveSpace

    var body: some View {
        VStack(spacing: 20) {
            Text("æˆ¿é—´è®¾è®¡å™¨")
                .font(.largeTitle)

            if !appState.isImmersive {
                Button("è¿›å…¥æ²‰æµ¸å¼ç©ºé—´") {
                    Task {
                        await openImmersiveSpace()
                    }
                }
                .buttonStyle(.borderedProminent)
            } else {
                Button("é€€å‡ºæ²‰æµ¸å¼ç©ºé—´") {
                    Task {
                        await closeImmersiveSpace()
                    }
                }
                .buttonStyle(.bordered)
            }
        }
        .padding()
    }

    private func openImmersiveSpace() async {
        await openImmersiveSpace(id: "ImmersiveSpace")
        appState.isImmersive = true
    }

    private func closeImmersiveSpace() async {
        await dismissImmersiveSpace()
        appState.isImmersive = false
    }
}
```

### æµ‹è¯•éªŒè¯
- ç‚¹å‡»æŒ‰é’®å¯ä»¥æ‰“å¼€/å…³é—­æ²‰æµ¸å¼ç©ºé—´
- æŒ‰é’®æ–‡å­—æ ¹æ®çŠ¶æ€å˜åŒ–

### å­¦ä¹ é‡ç‚¹
- `@Environment(\.openImmersiveSpace)` ç¯å¢ƒå€¼
- ##### `@Environment(\.dismissImmersiveSpace)` ç¯å¢ƒå€¼
- async/await å¼‚æ­¥æ“ä½œ
- Task åŒ…è£…å¼‚æ­¥è°ƒç”¨

---

# é˜¶æ®µ2: é™æ€3Då†…å®¹

## è¿­ä»£ 7: åˆ›å»º RealityView

### ç›®æ ‡
åœ¨æ²‰æµ¸å¼ç©ºé—´ä¸­åˆ›å»ºç¬¬ä¸€ä¸ª RealityViewï¼Œä¸º 3D å†…å®¹åšå‡†å¤‡

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. ä¿®æ”¹ `ImmersiveView.body` - æ·»åŠ  RealityView

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
import SwiftUI
import RealityKit

struct ImmersiveView: View {
    @Environment(AppState.self) private var appState

    var body: some View {
        RealityView { content in
            // è¿™é‡Œå°†æ·»åŠ  3D å†…å®¹
            print("RealityView created")
        }
    }
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´åï¼Œæ§åˆ¶å°æ‰“å° "RealityView created"
- çœ‹åˆ°ç©ºçš„ 3D ç©ºé—´

### å­¦ä¹ é‡ç‚¹
- `RealityView` çš„åŸºæœ¬ç»“æ„
- RealityView çš„ content é—­åŒ…
- RealityKit çš„å¯¼å…¥

---

## è¿­ä»£ 8: åœ¨ AppState ä¸­åˆ›å»ºæ ¹å®ä½“

### ç›®æ ‡
åˆ›å»ºç®¡ç† 3D å†…å®¹çš„æ ¹å®ä½“

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `contentRoot` å±æ€§
2. `setupContentEntity()` - è®¾ç½®å†…å®¹å®ä½“

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
import Foundation
import Observation
import RealityKit

@Observable
@MainActor
class AppState {
    var isImmersive = false

    // 3D å†…å®¹çš„æ ¹å®ä½“
    let contentRoot = Entity()

    init() {
        print("AppState initialized")
        setupContentEntity()
    }

    func setupContentEntity() {
        contentRoot.name = "ContentRoot"
        print("Content entity setup complete")
    }
}
```

### æµ‹è¯•éªŒè¯
- æ§åˆ¶å°æ‰“å° "Content entity setup complete"

### å­¦ä¹ é‡ç‚¹
- RealityKit çš„ `Entity` ç±»
- å®ä½“çš„å‘½å
- å®ä½“å±‚çº§ç»“æ„çš„æ ¹èŠ‚ç‚¹

---

## è¿­ä»£ 9: å°†æ ¹å®ä½“æ·»åŠ åˆ° RealityView

### ç›®æ ‡
å°† AppState ä¸­çš„æ ¹å®ä½“æ·»åŠ åˆ°åœºæ™¯ä¸­

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. ä¿®æ”¹ RealityView é—­åŒ…

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
struct ImmersiveView: View {
    @Environment(AppState.self) private var appState

    var body: some View {
        RealityView { content in
            content.add(appState.contentRoot)
            print("Root entity added to scene")
        }
    }
}
```

### æµ‹è¯•éªŒè¯
- æ§åˆ¶å°æ‰“å° "Root entity added to scene"

### å­¦ä¹ é‡ç‚¹
- RealityView content çš„ `add()` æ–¹æ³•
- å®ä½“æ·»åŠ åˆ°åœºæ™¯

---

## è¿­ä»£ 10: åˆ›å»ºç¬¬ä¸€ä¸ª 3D çƒä½“

### ç›®æ ‡
åˆ›å»ºå¹¶æ˜¾ç¤ºç¬¬ä¸€ä¸ª 3D çƒä½“

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `createTestSphere()` - åˆ›å»ºæµ‹è¯•çƒä½“

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
func setupContentEntity() {
    contentRoot.name = "ContentRoot"
    createTestSphere()
    print("Content entity setup complete")
}

private func createTestSphere() {
    // åˆ›å»ºçƒä½“ç½‘æ ¼
    let mesh = MeshResource.generateSphere(radius: 0.1)

    // åˆ›å»ºæè´¨ï¼ˆç»¿è‰²ï¼‰
    let material = SimpleMaterial(
        color: .green,
        roughness: 0.2,
        isMetallic: true
    )

    // åˆ›å»ºæ¨¡å‹å®ä½“
    let sphere = ModelEntity(
        mesh: mesh,
        materials: [material]
    )

    // è®¾ç½®ä½ç½®ï¼ˆåœ¨ç”¨æˆ·å‰æ–¹1ç±³ï¼‰
    sphere.position = [0, 1.5, -1]
    sphere.name = "TestSphere"

    // æ·»åŠ åˆ°æ ¹å®ä½“
    contentRoot.addChild(sphere)

    print("Test sphere created at position: \(sphere.position)")
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´åï¼Œçœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„é‡‘å±çƒä½“æ‚¬æµ®åœ¨å‰æ–¹

### å­¦ä¹ é‡ç‚¹
- `MeshResource.generateSphere()` åˆ›å»ºçƒä½“ç½‘æ ¼
- `SimpleMaterial` æè´¨ç³»ç»Ÿ
- `ModelEntity` æ¨¡å‹å®ä½“
- å®ä½“ä½ç½®è®¾ç½®ï¼ˆpositionï¼‰
- çˆ¶å­å…³ç³»ï¼ˆaddChildï¼‰
- visionOS åæ ‡ç³»ï¼ˆyè½´å‘ä¸Šï¼Œzè½´å‘å‰ä¸ºè´Ÿï¼‰

---

## ä»£ç è¯¦è§£

 createTestSphere() æ–¹æ³•çš„æ­¥éª¤ï¼š



1. åˆ›å»ºçƒä½“ç½‘æ ¼ (ç¬¬34è¡Œ)

  \- MeshResource.generateSphere(radius: 0.1) - åŠå¾„10å˜ç±³çš„çƒä½“

2. åˆ›å»ºæè´¨ (ç¬¬37-41è¡Œ)

  \- SimpleMaterial - ç®€å•æè´¨ç³»ç»Ÿ

  \- color: .green - ç»¿è‰²

  \- roughness: 0.2 - ä½ç²—ç³™åº¦ï¼ˆè¾ƒå…‰æ»‘ï¼‰

  \- isMetallic: true - é‡‘å±è´¨æ„Ÿ

3. åˆ›å»ºæ¨¡å‹å®ä½“ (ç¬¬44-47è¡Œ)

  \- ModelEntity - å¯æ¸²æŸ“çš„ 3D æ¨¡å‹

4. è®¾ç½®ä½ç½® (ç¬¬50è¡Œ)

  \- [0, 1.5, -1] - x=0ï¼ˆä¸­å¿ƒï¼‰ï¼Œy=1.5ï¼ˆçœ¼ç›é«˜åº¦ï¼‰ï¼Œz=-1ï¼ˆå‰æ–¹1ç±³ï¼‰

  \- visionOS åæ ‡ç³»ï¼šyè½´å‘ä¸Šï¼Œzè½´å‘å‰ä¸ºè´Ÿ

5. æ·»åŠ åˆ°åœºæ™¯ (ç¬¬54è¡Œ)

  \- contentRoot.addChild(sphere) - å»ºç«‹çˆ¶å­å…³ç³»



## è¿­ä»£ 11: æ·»åŠ å¤šä¸ªä¸åŒé¢œè‰²çš„çƒä½“

### ç›®æ ‡
åˆ›å»ºå¤šä¸ªçƒä½“ï¼Œå­¦ä¹ å®ä½“ç®¡ç†

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `createColoredSphere(color:position:)` - åˆ›å»ºå½©è‰²çƒä½“
2. ä¿®æ”¹ `setupContentEntity()` - åˆ›å»ºå¤šä¸ªçƒä½“

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
func setupContentEntity() {
    contentRoot.name = "ContentRoot"

    // åˆ›å»ºå¤šä¸ªçƒä½“
    createColoredSphere(color: .red, position: [-0.3, 1.5, -1])
    createColoredSphere(color: .green, position: [0, 1.5, -1])
    createColoredSphere(color: .blue, position: [0.3, 1.5, -1])

    print("Content entity setup complete")
}

private func createColoredSphere(
    color: UIColor,
    position: SIMD3<Float>
) {
    let mesh = MeshResource.generateSphere(radius: 0.1)
    let material = SimpleMaterial(
        color: color,
        roughness: 0.2,
        isMetallic: true
    )

    let sphere = ModelEntity(mesh: mesh, materials: [material])
    sphere.position = position
    sphere.name = "Sphere_\(color.description)"

    contentRoot.addChild(sphere)
    print("Sphere created at \(position)")
}
```

### æµ‹è¯•éªŒè¯
- çœ‹åˆ°ä¸‰ä¸ªçƒä½“ï¼ˆçº¢ã€ç»¿ã€è“ï¼‰æ’æˆä¸€æ’

### å­¦ä¹ é‡ç‚¹
- å‚æ•°åŒ–æ–¹æ³•åˆ›å»ºå®ä½“
- `SIMD3<Float>` å‘é‡ç±»å‹
- é¢œè‰²å‚æ•°ä¼ é€’

---

## è¿­ä»£ 12: æ·»åŠ çƒä½“å­˜å‚¨å­—å…¸

### ç›®æ ‡
ä½¿ç”¨å­—å…¸ç®¡ç†çƒä½“ï¼Œä¸ºåç»­åˆ é™¤åŠŸèƒ½åšå‡†å¤‡

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `sphereEntities` å±æ€§
2. ä¿®æ”¹ `createColoredSphere` - å­˜å‚¨åˆ°å­—å…¸

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    var isImmersive = false
    let contentRoot = Entity()

    // å­˜å‚¨æ‰€æœ‰çƒä½“å®ä½“
    private(set) var sphereEntities: [UUID: ModelEntity] = [:]

    // ... å…¶ä»–ä»£ç 
}

private func createColoredSphere(
    color: UIColor,
    position: SIMD3<Float>
) {
    let mesh = MeshResource.generateSphere(radius: 0.1)
    let material = SimpleMaterial(
        color: color,
        roughness: 0.2,
        isMetallic: true
    )

    let sphere = ModelEntity(mesh: mesh, materials: [material])
    sphere.position = position

    let id = UUID()
    sphere.name = "Sphere_\(id)"

    contentRoot.addChild(sphere)
    sphereEntities[id] = sphere

    print("Sphere \(id) created at \(position)")
}
```

### æµ‹è¯•éªŒè¯
- åŠŸèƒ½ä¸ä¹‹å‰ç›¸åŒï¼Œä½†çƒä½“è¢«å­˜å‚¨åˆ°å­—å…¸ä¸­

### å­¦ä¹ é‡ç‚¹
- ä½¿ç”¨ UUID ä½œä¸ºå®ä½“æ ‡è¯†
- å­—å…¸å­˜å‚¨å®ä½“å¼•ç”¨
- `private(set)` è®¿é—®æ§åˆ¶



## ä»£ç è¯¦è§£

1. æ·»åŠ  sphereEntities å­—å…¸å±æ€§ (ç¬¬23è¡Œ)

  \- private(set) var sphereEntities: [UUID: ModelEntity] = [:]

  \- ä½¿ç”¨ UUID ä½œä¸ºé”®ï¼ŒModelEntity ä½œä¸ºå€¼

  \- private(set) è¡¨ç¤ºå¤–éƒ¨åªè¯»ï¼Œå†…éƒ¨å¯å†™

2. ä¿®æ”¹ createColoredSphere() æ–¹æ³• (ç¬¬55-61è¡Œ)

  \- ç”Ÿæˆå”¯ä¸€çš„ UUID (ç¬¬55è¡Œ)

  \- ä½¿ç”¨ UUID å‘½åçƒä½“ (ç¬¬56è¡Œ)

  \- å°†çƒä½“å­˜å‚¨åˆ°å­—å…¸ä¸­ (ç¬¬59è¡Œ)

  \- æ‰“å°æ—¶åŒ…å« UUID ä¿¡æ¯ (ç¬¬61è¡Œ)



#### ä¸ºä»€ä¹ˆä½¿ç”¨å­—å…¸å­˜å‚¨ï¼Ÿ

 sphereEntities[id] = sphere

 \- å¿«é€ŸæŸ¥æ‰¾ - é€šè¿‡ UUID å¯ä»¥ O(1) æ—¶é—´æ‰¾åˆ°çƒä½“

 \- å”¯ä¸€æ ‡è¯† - UUID ç¡®ä¿æ¯ä¸ªçƒä½“æœ‰å”¯ä¸€ID

 \- ä¾¿äºç®¡ç† - åç»­å¯ä»¥è½»æ¾åˆ é™¤ã€ä¿®æ”¹ç‰¹å®šçƒä½“

 \- çŠ¶æ€è¿½è¸ª - @Observable ä¼šè‡ªåŠ¨è¿½è¸ªå­—å…¸å˜åŒ–



#### private(set) çš„ä½œç”¨ï¼š

 private(set) var sphereEntities: [UUID: ModelEntity] = [:]

 \- å¤–éƒ¨ä»£ç å¯ä»¥è¯»å– appState.sphereEntities

 \- å¤–éƒ¨ä»£ç ä¸èƒ½ä¿®æ”¹ appState.sphereEntities[id] = ...

 \- åªæœ‰ AppState å†…éƒ¨å¯ä»¥ä¿®æ”¹å­—å…¸

```
  sphereEntities å­—å…¸:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ UUID                    â”‚ ModelEntity  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 12345678-1234-...       â”‚ ğŸ”´ (çº¢çƒ)    â”‚
  â”‚ 87654321-4321-...       â”‚ ğŸŸ¢ (ç»¿çƒ)    â”‚
  â”‚ ABCDEF12-ABCD-...       â”‚ ğŸ”µ (è“çƒ)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



---

# é˜¶æ®µ3: ARKit ä¸–ç•Œè·Ÿè¸ª

## è¿­ä»£ 13: æ·»åŠ  ARKitSession

### ç›®æ ‡
åˆå§‹åŒ– ARKit ä¼šè¯ï¼Œä¸ºç©ºé—´è·Ÿè¸ªåšå‡†å¤‡

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `session` å±æ€§
2. `initializeARKit()` - åˆå§‹åŒ– ARKit

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
import ARKit

@Observable
@MainActor
class AppState {
    var isImmersive = false
    let contentRoot = Entity()
    private(set) var sphereEntities: [UUID: ModelEntity] = [:]

    // ARKit session
    private let session = ARKitSession()

    init() {
        print("AppState initialized")
        setupContentEntity()
    }

    func initializeARKit() async {
        print("ARKit initialization started")
        // åç»­è¿­ä»£å°†æ·»åŠ å…·ä½“é€»è¾‘
    }
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- `ARKitSession` ç±»ï¼ˆvisionOS ç‰¹æœ‰ï¼‰
- ä¸ iOS çš„ ARSession çš„åŒºåˆ«

### ä»£ç è¯¦è§£

 ARKitSession vs iOS çš„ ARSession

 private let session = ARKitSession() // visionOS

 âš ï¸ é‡è¦åŒºåˆ«ï¼š

 \- âŒ iOS: ARSession

 \- âœ… visionOS: ARKitSession

 è¿™æ˜¯ visionOS ç‰¹æœ‰çš„ APIï¼Œä¸ iOS çš„ ARKit æœ‰æ˜¾è‘—å·®å¼‚ï¼



 async æ–¹æ³•

 func initializeARKit() async {

 \- async å…³é”®å­—è¡¨ç¤ºå¼‚æ­¥æ–¹æ³•

 \- å¯ä»¥ä½¿ç”¨ await è°ƒç”¨å…¶ä»–å¼‚æ­¥æ–¹æ³•

 \- ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹

 \- é€‚åˆè€—æ—¶çš„åˆå§‹åŒ–æ“ä½œ

```
  visionOS ARKit æ¶æ„

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      ARKitSession               â”‚ â† ä¼šè¯ç®¡ç†å™¨
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  WorldTrackingProvider          â”‚ â† ä¸‹ä¸€è¿­ä»£æ·»åŠ 
  â”‚  RoomTrackingProvider           â”‚ â† åç»­è¿­ä»£æ·»åŠ 
  â”‚  PlaneDetectionProvider         â”‚ â† å¯é€‰åŠŸèƒ½
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ä¸ iOS ARKit å¯¹æ¯”

  | iOS ARKit       | visionOS ARKit                   |
  |-----------------|----------------------------------|
  | ARSession       | ARKitSession                     |
  | ARConfiguration | Provider (WorldTrackingProvider) |
  | delegate        | async/await streams              |
  | ARFrame         | Update events                    |

  ---
```



---

## è¿­ä»£ 14: æ·»åŠ  WorldTrackingProvider

### ç›®æ ‡
æ·»åŠ ä¸–ç•Œè·Ÿè¸ªæä¾›è€…

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `worldTracking` å±æ€§
2. ä¿®æ”¹ `initializeARKit()` - å¯åŠ¨ä¸–ç•Œè·Ÿè¸ª

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§

    private let session = ARKitSession()
    private let worldTracking = WorldTrackingProvider()

    // ... å…¶ä»–ä»£ç 
}

func initializeARKit() async {
    print("ARKit initialization started")

    do {
        try await session.run([worldTracking])
        print("ARKit session started successfully")
    } catch {
        print("ARKit session failed: \(error)")
    }
}
```

### æµ‹è¯•éªŒè¯
- éœ€è¦åœ¨è¿›å…¥æ²‰æµ¸å¼ç©ºé—´æ—¶è°ƒç”¨ï¼ˆä¸‹ä¸€è¿­ä»£ï¼‰

### å­¦ä¹ é‡ç‚¹
- `WorldTrackingProvider` ç±»
- `session.run()` å¯åŠ¨è·Ÿè¸ª
- async/await é”™è¯¯å¤„ç†





---

## è¿­ä»£ 15: åœ¨è¿›å…¥æ²‰æµ¸å¼ç©ºé—´æ—¶å¯åŠ¨ ARKit

### ç›®æ ‡
åœ¨æ­£ç¡®çš„æ—¶æœºå¯åŠ¨ ARKit ä¼šè¯

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `.task` ä¿®é¥°ç¬¦å¯åŠ¨ ARKit

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
struct ImmersiveView: View {
    @Environment(AppState.self) private var appState

    var body: some View {
        RealityView { content in
            content.add(appState.contentRoot)
            print("Root entity added to scene")
        }
        .task {
            await appState.initializeARKit()
        }
    }
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´æ—¶ï¼Œæ§åˆ¶å°æ˜¾ç¤º "ARKit session started successfully"
- å¦‚æœå¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥æƒé™

### å­¦ä¹ é‡ç‚¹
- `.task` ä¿®é¥°ç¬¦çš„ç”Ÿå‘½å‘¨æœŸ
- å¼‚æ­¥åˆå§‹åŒ–æ—¶æœº
- ARKit ä¼šè¯ç®¡ç†



### ä»£ç è¯¦è§£

 \- âœ… .task ä¿®é¥°ç¬¦ - SwiftUI ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨

  \- å½“è§†å›¾å‡ºç°æ—¶è‡ªåŠ¨æ‰§è¡Œ

  \- å½“è§†å›¾æ¶ˆå¤±æ—¶è‡ªåŠ¨å–æ¶ˆ

  \- æ”¯æŒå¼‚æ­¥æ“ä½œï¼ˆasync/awaitï¼‰

 \- âœ… å¼‚æ­¥åˆå§‹åŒ–æ—¶æœº - ARKit ä¼šè¯åº”è¯¥åœ¨æ²‰æµ¸å¼ç©ºé—´å‡ºç°æ—¶å¯åŠ¨

 \- âœ… ARKit ä¼šè¯ç®¡ç† - ä¼šè¯ä¸è§†å›¾ç”Ÿå‘½å‘¨æœŸç»‘å®š



---

## è¿­ä»£ 16: æ·»åŠ  Info.plist æƒé™é…ç½®

### ç›®æ ‡
é…ç½®åº”ç”¨æƒé™ï¼Œå…è®¸ä½¿ç”¨ä¸–ç•Œæ„ŸçŸ¥

### æ–°å»ºæ–‡ä»¶
- `Info.plist`ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

### æ–¹æ³•åˆ—è¡¨
æ— ï¼ˆé…ç½®æ–‡ä»¶ï¼‰

### ä»£ç è¦ç‚¹

**Info.plist**:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>NSWorldSensingUsageDescription</key>
    <string>åº”ç”¨éœ€è¦æ‰«ææˆ¿é—´ä»¥æ”¾ç½®è™šæ‹Ÿç‰©ä½“</string>
</dict>
</plist>
```

### æµ‹è¯•éªŒè¯
- ARKit ä¼šè¯èƒ½å¤ŸæˆåŠŸå¯åŠ¨
- é¦–æ¬¡è¿è¡Œä¼šæç¤ºæƒé™è¯·æ±‚

### å­¦ä¹ é‡ç‚¹
- visionOS æƒé™ç³»ç»Ÿ
- `NSWorldSensingUsageDescription` å¿…éœ€æ€§
- Info.plist é…ç½®



### ä»£ç è¯¦è§£

\- âœ… NSWorldSensingUsageDescription - visionOS ä¸–ç•Œæ„ŸçŸ¥æƒé™çš„å¿…éœ€é…ç½®

  \- ç”¨äº ARKit çš„ç©ºé—´æ‰«æåŠŸèƒ½

  \- ç”¨äºæˆ¿é—´è·Ÿè¸ªå’Œä¸–ç•Œè·Ÿè¸ª

  \- å¿…é¡»æä¾›ï¼Œå¦åˆ™ ARKit æ— æ³•å¯åŠ¨

 \- âœ… visionOS æƒé™ç³»ç»Ÿ - éœ€è¦å‘ç”¨æˆ·è¯´æ˜ä¸ºä½•éœ€è¦æ­¤æƒé™

 \- âœ… Info.plist é…ç½® - iOS/visionOS åº”ç”¨çš„å…ƒæ•°æ®é…ç½®æ–‡ä»¶

---

# é˜¶æ®µ4: äº¤äº’ä¸æ”¾ç½®

## è¿­ä»£ 17: æ·»åŠ é¢„è§ˆçƒä½“æ˜¾ç¤ºçŠ¶æ€

### ç›®æ ‡
æ·»åŠ æ§åˆ¶é¢„è§ˆçƒä½“æ˜¾ç¤ºçš„çŠ¶æ€

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `showPreviewSphere` å±æ€§

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    var isImmersive = false
    var showPreviewSphere = false  // æ–°å¢

    // ... å…¶ä»–ä»£ç 
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- å¸ƒå°”çŠ¶æ€æ§åˆ¶

1. å¸ƒå°”çŠ¶æ€æ§åˆ¶: showPreviewSphere æ˜¯ä¸€ä¸ªç®€å•çš„å¸ƒå°”å±æ€§ï¼Œç”¨äºæ§åˆ¶é¢„è§ˆçƒä½“çš„æ˜¾ç¤º/éšè—çŠ¶æ€
2. @Observable è‡ªåŠ¨è¿½è¸ª: ç”±äº AppState ä½¿ç”¨äº† @Observable å®ï¼Œè¿™ä¸ªå±æ€§çš„å˜åŒ–ä¼šè‡ªåŠ¨è¢« SwiftUI è¿½è¸ª
3. æ•°æ®æµå‡†å¤‡: è¿™ä¸ªå±æ€§å°†åœ¨åç»­è¿­ä»£ä¸­è¢« UI å±‚ï¼ˆContentViewï¼‰å’Œè§†å›¾å±‚ï¼ˆImmersiveViewï¼‰ä½¿ç”¨

---

## è¿­ä»£ 18: åœ¨ ContentView æ·»åŠ "æ·»åŠ çƒä½“"æŒ‰é’®

### ç›®æ ‡
æ·»åŠ  UI æ§ä»¶æ¥è§¦å‘é¢„è§ˆçƒä½“

### ä¿®æ”¹æ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ "æ·»åŠ çƒä½“"æŒ‰é’®

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
struct ContentView: View {
    @Environment(AppState.self) private var appState
    @Environment(\.openImmersiveSpace) private var openImmersiveSpace
    @Environment(\.dismissImmersiveSpace) private var dismissImmersiveSpace

    var body: some View {
        VStack(spacing: 20) {
            Text("æˆ¿é—´è®¾è®¡å™¨")
                .font(.largeTitle)

            if !appState.isImmersive {
                Button("è¿›å…¥æ²‰æµ¸å¼ç©ºé—´") {
                    Task { await openImmersiveSpace() }
                }
                .buttonStyle(.borderedProminent)
            } else {
                VStack(spacing: 15) {
                    Button(appState.showPreviewSphere ? "å–æ¶ˆæ”¾ç½®" : "æ·»åŠ çƒä½“") {
                        appState.showPreviewSphere.toggle()
                    }
                    .buttonStyle(.borderedProminent)

                    Button("é€€å‡ºæ²‰æµ¸å¼ç©ºé—´") {
                        Task { await closeImmersiveSpace() }
                    }
                    .buttonStyle(.bordered)
                }
            }
        }
        .padding()
    }

    // ... å…¶ä»–æ–¹æ³•
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´åï¼Œçœ‹åˆ°"æ·»åŠ çƒä½“"æŒ‰é’®
- ç‚¹å‡»åæŒ‰é’®æ–‡å­—å˜ä¸º"å–æ¶ˆæ”¾ç½®"

### å­¦ä¹ é‡ç‚¹
- æ¡ä»¶æ¸²æŸ“ï¼ˆif/elseï¼‰
- æŒ‰é’®çŠ¶æ€åŠ¨æ€å˜åŒ–
- `.toggle()` æ–¹æ³•



### ä»£ç è¯¦è§£

1. æ¡ä»¶æ¸²æŸ“ï¼ˆif/elseï¼‰: æ ¹æ® isImmersive çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„ UI
2. æŒ‰é’®çŠ¶æ€åŠ¨æ€å˜åŒ–: ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ appState.showPreviewSphere ? "å–æ¶ˆæ”¾ç½®" : "æ·»åŠ çƒä½“" æ”¹å˜æŒ‰é’®æ–‡å­—
3. .toggle() æ–¹æ³•: ç®€æ´åœ°åˆ‡æ¢å¸ƒå°”å€¼çŠ¶æ€
4. VStack å¸ƒå±€: ä½¿ç”¨ spacing: 15 è®¾ç½®æŒ‰é’®ä¹‹é—´çš„é—´è·
5. æŒ‰é’®æ ·å¼: .borderedProminent ç”¨äºä¸»æ“ä½œï¼Œ.bordered ç”¨äºæ¬¡è¦æ“ä½œ

---

## è¿­ä»£ 19: åˆ›å»ºé¢„è§ˆçƒä½“å®ä½“

### ç›®æ ‡
åˆ›å»ºè·Ÿéšå¤´éƒ¨çš„é¢„è§ˆçƒä½“

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. `createPreviewSphere()` - åˆ›å»ºé¢„è§ˆçƒä½“

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
struct ImmersiveView: View {
    @Environment(AppState.self) private var appState
    @State private var previewSphere: ModelEntity?

    var body: some View {
        RealityView { content in
            content.add(appState.contentRoot)

            // åˆ›å»ºé¢„è§ˆçƒä½“
            let preview = createPreviewSphere()
            previewSphere = preview

            // åˆ›å»ºå¤´éƒ¨é”šç‚¹
            let headAnchor = AnchorEntity(.head)
            headAnchor.addChild(preview)
            content.add(headAnchor)

            print("Preview sphere created")
        }
        .task {
            await appState.initializeARKit()
        }
    }

    private func createPreviewSphere() -> ModelEntity {
        let mesh = MeshResource.generateSphere(radius: 0.1)

        // åŠé€æ˜ç°è‰²æè´¨
        var material = SimpleMaterial()
        material.color = .init(
            tint: .gray.withAlphaComponent(0.5)
        )

        let sphere = ModelEntity(mesh: mesh, materials: [material])
        sphere.position = [0, 0, -1]  // å¤´éƒ¨å‰æ–¹1ç±³
        sphere.name = "PreviewSphere"
        sphere.isEnabled = false  // åˆå§‹éšè—

        return sphere
    }
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯
- é¢„è§ˆçƒä½“æš‚æ—¶ä¸å¯è§ï¼ˆisEnabled = falseï¼‰

### å­¦ä¹ é‡ç‚¹
- `AnchorEntity(.head)` å¤´éƒ¨é”šç‚¹
- åŠé€æ˜æè´¨åˆ›å»º
- `isEnabled` æ§åˆ¶å¯è§æ€§
- ç›¸å¯¹äºå¤´éƒ¨çš„ä½ç½®



### ä»£ç è¯¦è§£

1. AnchorEntity(.head) å¤´éƒ¨é”šç‚¹:

  \- è¿™æ˜¯ visionOS ç‰¹æœ‰çš„é”šç‚¹ç±»å‹

  \- é¢„è§ˆçƒä½“ä¼šè·Ÿéšç”¨æˆ·çš„å¤´éƒ¨ç§»åŠ¨

  \- å§‹ç»ˆä¿æŒåœ¨ç”¨æˆ·è§†é‡å‰æ–¹

2. åŠé€æ˜æè´¨åˆ›å»º:

  \- ä½¿ç”¨ SimpleMaterial()

  \- é€šè¿‡ .withAlphaComponent(0.5) è®¾ç½®50%é€æ˜åº¦

  \- ç°è‰²è¡¨ç¤ºè¿™æ˜¯é¢„è§ˆçŠ¶æ€

3. isEnabled æ§åˆ¶å¯è§æ€§:

  \- è®¾ç½®ä¸º false åˆå§‹éšè—

  \- åç»­é€šè¿‡æ”¹å˜æ­¤å±æ€§æ˜¾ç¤º/éšè—çƒä½“

4. ç›¸å¯¹äºå¤´éƒ¨çš„ä½ç½®:

  \- [0, 0, -1] è¡¨ç¤ºå¤´éƒ¨å‰æ–¹1ç±³

  \- x=0ï¼ˆä¸­å¿ƒï¼‰ã€y=0ï¼ˆä¸å¤´éƒ¨åŒé«˜ï¼‰ã€z=-1ï¼ˆå‰æ–¹1ç±³ï¼‰

5. å®ä½“å±‚çº§ç»“æ„:

 content (åœºæ™¯)

 â”œâ”€â”€ contentRoot (å†…å®¹æ ¹)

 â””â”€â”€ headAnchor (å¤´éƒ¨é”šç‚¹)

   â””â”€â”€ previewSphere (é¢„è§ˆçƒä½“)

---

## è¿­ä»£ 20: æ ¹æ®çŠ¶æ€æ˜¾ç¤º/éšè—é¢„è§ˆçƒä½“

### ç›®æ ‡
è®©é¢„è§ˆçƒä½“å“åº”çŠ¶æ€å˜åŒ–

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `.onChange` ç›‘å¬çŠ¶æ€

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
var body: some View {
    RealityView { content in
        // ... ç°æœ‰ä»£ç 
    }
    .task {
        await appState.initializeARKit()
    }
    .onChange(of: appState.showPreviewSphere) { _, newValue in
        previewSphere?.isEnabled = newValue
        print("Preview sphere visible: \(newValue)")
    }
}
```

### æµ‹è¯•éªŒè¯
- ç‚¹å‡»"æ·»åŠ çƒä½“"æŒ‰é’®ï¼Œé¢„è§ˆçƒä½“å‡ºç°åœ¨è§†é‡å‰æ–¹
- ç‚¹å‡»"å–æ¶ˆæ”¾ç½®"ï¼Œé¢„è§ˆçƒä½“æ¶ˆå¤±
- çƒä½“è·Ÿéšå¤´éƒ¨ç§»åŠ¨

### å­¦ä¹ é‡ç‚¹
- `.onChange(of:)` ç›‘å¬çŠ¶æ€å˜åŒ–
- å®ä½“å¯è§æ€§æ§åˆ¶
- å¤´éƒ¨é”šå®šæ•ˆæœ



### ä»£ç è¯¦è§£

1. .onChange(of:) ç›‘å¬çŠ¶æ€å˜åŒ–:

  \- SwiftUI æä¾›çš„çŠ¶æ€ç›‘å¬ä¿®é¥°ç¬¦

  \- å½“ appState.showPreviewSphere å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘

  \- æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šoldValueï¼ˆç”¨ _ å¿½ç•¥ï¼‰å’Œ newValueï¼ˆæ–°å€¼ï¼‰

2. å®ä½“å¯è§æ€§æ§åˆ¶:

  \- isEnabled = true: å®ä½“å¯è§ä¸”å‚ä¸äº¤äº’

  \- isEnabled = false: å®ä½“éšè—ä¸”ä¸å‚ä¸äº¤äº’

  \- ä½¿ç”¨ previewSphere?.isEnabled å®‰å…¨è®¿é—®å¯é€‰å±æ€§

3. å¤´éƒ¨é”šå®šæ•ˆæœ:

  \- é¢„è§ˆçƒä½“é™„åŠ åˆ° AnchorEntity(.head)

  \- ä¼šè‡ªåŠ¨è·Ÿéšç”¨æˆ·å¤´éƒ¨ç§»åŠ¨

  \- å§‹ç»ˆä¿æŒåœ¨è§†é‡å‰æ–¹1ç±³å¤„

4. æ•°æ®æµå®Œæ•´æ€§:

 ContentView (UIæŒ‰é’®)

â€‹    â†“ toggle()

 AppState.showPreviewSphere (çŠ¶æ€)

â€‹    â†“ onChangeç›‘å¬

 ImmersiveView.previewSphere.isEnabled (3Då®ä½“s

---

## è¿­ä»£ 21: æ·»åŠ ç¢°æ’ç»„ä»¶

### ç›®æ ‡
ä¸ºé¢„è§ˆçƒä½“æ·»åŠ ç¢°æ’æ£€æµ‹ï¼Œå‡†å¤‡æ¥æ”¶æ‰‹åŠ¿

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`

### æ–¹æ³•åˆ—è¡¨
1. ä¿®æ”¹ `createPreviewSphere()` - æ·»åŠ ç¢°æ’

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
private func createPreviewSphere() -> ModelEntity {
    let mesh = MeshResource.generateSphere(radius: 0.1)

    var material = SimpleMaterial()
    material.color = .init(tint: .gray.withAlphaComponent(0.5))

    let sphere = ModelEntity(mesh: mesh, materials: [material])
    sphere.position = [0, 0, -1]
    sphere.name = "PreviewSphere"
    sphere.isEnabled = false

    // æ·»åŠ ç¢°æ’å½¢çŠ¶
    sphere.generateCollisionShapes(recursive: false)

    // æ·»åŠ è¾“å…¥ç›®æ ‡ç»„ä»¶ï¼ˆå…è®¸é—´æ¥è¾“å…¥ï¼šè§†çº¿+æ‰‹åŠ¿ï¼‰
    sphere.components.set(
        InputTargetComponent(allowedInputTypes: [.indirect])
    )

    print("Preview sphere collision enabled")
    return sphere
}
```

### æµ‹è¯•éªŒè¯
- é¢„è§ˆçƒä½“å¯ä»¥è¢«è§†çº¿"é€‰ä¸­"

### å­¦ä¹ é‡ç‚¹
- `generateCollisionShapes()` ç”Ÿæˆç¢°æ’ä½“
- `InputTargetComponent` è¾“å…¥ç»„ä»¶
- .indirect` è¾“å…¥ç±»å‹ï¼ˆè§†çº¿+pinch æ‰‹åŠ¿ï¼‰



### ä»£ç è¯¦è§£

1. generateCollisionShapes(recursive: false) ç”Ÿæˆç¢°æ’ä½“:

  \- è‡ªåŠ¨æ ¹æ®å®ä½“çš„ç½‘æ ¼ç”Ÿæˆç¢°æ’å½¢çŠ¶

  \- recursive: false è¡¨ç¤ºåªä¸ºå½“å‰å®ä½“ç”Ÿæˆï¼Œä¸é€’å½’å­å®ä½“

  \- ç¢°æ’å½¢çŠ¶ç”¨äºç‰©ç†ç¢°æ’æ£€æµ‹å’Œå°„çº¿æŠ•å°„

2. InputTargetComponent è¾“å…¥ç»„ä»¶:

  \- RealityKit çš„ç»„ä»¶ç³»ç»Ÿï¼ˆECSæ¶æ„ï¼‰

  \- ä½¿å®ä½“èƒ½å¤Ÿæ¥æ”¶ç”¨æˆ·è¾“å…¥

  \- é€šè¿‡ components.set() æ·»åŠ ç»„ä»¶

3. .indirect è¾“å…¥ç±»å‹ï¼ˆè§†çº¿ + pinch æ‰‹åŠ¿ï¼‰:

  \- visionOS çš„é—´æ¥äº¤äº’æ–¹å¼

  \- ç”¨æˆ·é€šè¿‡è§†çº¿é€‰ä¸­ç‰©ä½“

  \- ç„¶åç”¨æ‰‹æŒ‡åš pinch æ‰‹åŠ¿ç¡®è®¤æ“ä½œ

  \- ä¸ç›´æ¥è§¦æ‘¸ä¸åŒï¼Œé€‚åˆç©ºé—´äº¤äº’

4. visionOS äº¤äº’æ¨¡å¼å¯¹æ¯”:

 .indirect (é—´æ¥è¾“å…¥)

 â”œâ”€â”€ è§†çº¿å®šä½ç›®æ ‡

 â””â”€â”€ pinch æ‰‹åŠ¿ç¡®è®¤



 .direct (ç›´æ¥è¾“å…¥)

 â””â”€â”€ æ‰‹ç›´æ¥è§¦æ‘¸ç‰©ä½“ï¼ˆéœ€è¦æ‰‹éƒ¨è·Ÿè¸ªï¼‰

5. ECS ç»„ä»¶ç³»ç»Ÿ:

 entity.components.set(ComponentType)

  \- Entity: å®¹å™¨ï¼ˆçƒä½“ï¼‰

  \- Component: åŠŸèƒ½æ¨¡å—ï¼ˆè¾“å…¥ã€ç‰©ç†ã€å˜æ¢ç­‰ï¼‰

  \- System: å¤„ç†é€»è¾‘ï¼ˆç”± RealityKit ç®¡ç†ï¼‰

---

## è¿­ä»£ 22: æ·»åŠ ç‚¹å‡»æ‰‹åŠ¿æ”¾ç½®çƒä½“

### ç›®æ ‡
å®ç°ç‚¹å‡»é¢„è§ˆçƒä½“æ”¾ç½®å®ä½“çš„åŠŸèƒ½

### ä¿®æ”¹æ–‡ä»¶
- `ImmersiveView.swift`
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨ï¼ˆImmersiveViewï¼‰
1. æ·»åŠ  `.gesture()` ä¿®é¥°ç¬¦

### æ–¹æ³•åˆ—è¡¨ï¼ˆAppStateï¼‰
2. `addSphereAtPosition(_:)` - åœ¨æŒ‡å®šä½ç½®æ·»åŠ çƒä½“

### ä»£ç è¦ç‚¹

**ImmersiveView.swift**:
```swift
var body: some View {
    RealityView { content in
        // ... ç°æœ‰ä»£ç 
    }
    .task {
        await appState.initializeARKit()
    }
    .onChange(of: appState.showPreviewSphere) { _, newValue in
        previewSphere?.isEnabled = newValue
    }
    .gesture(
        SpatialTapGesture()
            .targetedToAnyEntity()
            .onEnded { event in
                handleTap(event)
            }
    )
}

private func handleTap(_ event: EntityTargetValue<SpatialTapGesture.Value>) {
    guard let previewSphere,
          event.entity == previewSphere else {
        return
    }

    // è·å–é¢„è§ˆçƒä½“çš„ä¸–ç•Œä½ç½®
    let worldPosition = previewSphere.position(relativeTo: nil)

    // åœ¨è¯¥ä½ç½®åˆ›å»ºçƒä½“
    appState.addSphereAtPosition(worldPosition)

    // éšè—é¢„è§ˆçƒä½“
    appState.showPreviewSphere = false
}
```

**AppState.swift**:
```swift
func addSphereAtPosition(_ position: SIMD3<Float>) {
    let mesh = MeshResource.generateSphere(radius: 0.1)
    let material = SimpleMaterial(
        color: .blue,
        roughness: 0.2,
        isMetallic: true
    )

    let sphere = ModelEntity(mesh: mesh, materials: [material])
    sphere.position = position

    let id = UUID()
    sphere.name = "Sphere_\(id)"

    contentRoot.addChild(sphere)
    sphereEntities[id] = sphere

    print("Sphere placed at \(position)")
}
```

### æµ‹è¯•éªŒè¯
- ç‚¹å‡»"æ·»åŠ çƒä½“"ï¼Œé¢„è§ˆçƒä½“å‡ºç°
- ç§»åŠ¨å¤´éƒ¨è°ƒæ•´é¢„è§ˆä½ç½®
- ç”¨æ‰‹åŠ¿ç‚¹å‡»é¢„è§ˆçƒä½“ï¼Œåœ¨è¯¥ä½ç½®åˆ›å»ºè“è‰²çƒä½“
- é¢„è§ˆçƒä½“æ¶ˆå¤±

### å­¦ä¹ é‡ç‚¹
- `SpatialTapGesture` ç©ºé—´ç‚¹å‡»æ‰‹åŠ¿
- `.targetedToAnyEntity()` ç›®æ ‡ä»»æ„å®ä½“
- `position(relativeTo:)` è·å–ä¸–ç•Œåæ ‡
- æ‰‹åŠ¿å¤„ç†æµç¨‹

---

## è¿­ä»£ 23: æ·»åŠ åˆ é™¤æ‰€æœ‰çƒä½“åŠŸèƒ½

### ç›®æ ‡
æ·»åŠ æ¸…é™¤æ‰€æœ‰æ”¾ç½®çƒä½“çš„åŠŸèƒ½

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. `removeAllSpheres()` - åˆ é™¤æ‰€æœ‰çƒä½“

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
func removeAllSpheres() {
    for (id, sphere) in sphereEntities {
        sphere.removeFromParent()
        print("Sphere \(id) removed")
    }
    sphereEntities.removeAll()
    print("All spheres removed")
}
```

**ContentView.swift**:
```swift
VStack(spacing: 15) {
    Button(appState.showPreviewSphere ? "å–æ¶ˆæ”¾ç½®" : "æ·»åŠ çƒä½“") {
        appState.showPreviewSphere.toggle()
    }
    .buttonStyle(.borderedProminent)

    // æ–°å¢ï¼šåˆ é™¤æŒ‰é’®
    Button("åˆ é™¤æ‰€æœ‰çƒä½“") {
        appState.removeAllSpheres()
    }
    .buttonStyle(.bordered)
    .disabled(appState.sphereEntities.isEmpty)

    Button("é€€å‡ºæ²‰æµ¸å¼ç©ºé—´") {
        Task { await closeImmersiveSpace() }
    }
    .buttonStyle(.bordered)
}
```

### æµ‹è¯•éªŒè¯
- æ”¾ç½®å‡ ä¸ªçƒä½“
- ç‚¹å‡»"åˆ é™¤æ‰€æœ‰çƒä½“"ï¼Œæ‰€æœ‰çƒä½“æ¶ˆå¤±
- æŒ‰é’®åœ¨æ²¡æœ‰çƒä½“æ—¶ç¦ç”¨

### å­¦ä¹ é‡ç‚¹
- `removeFromParent()` ä»åœºæ™¯ç§»é™¤
- å­—å…¸æ¸…ç©º
- æŒ‰é’®ç¦ç”¨çŠ¶æ€ï¼ˆ.disabledï¼‰

---

# é˜¶æ®µ5: æˆ¿é—´è·Ÿè¸ª

## è¿­ä»£ 24: æ·»åŠ  RoomTrackingProvider

### ç›®æ ‡
æ·»åŠ æˆ¿é—´è·Ÿè¸ªæä¾›è€…

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `roomTracking` å±æ€§
2. ä¿®æ”¹ `initializeARKit()` - åŒæ—¶å¯åŠ¨æˆ¿é—´è·Ÿè¸ª

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§

    private let session = ARKitSession()
    private let worldTracking = WorldTrackingProvider()
    private let roomTracking = RoomTrackingProvider()  // æ–°å¢

    // ... å…¶ä»–ä»£ç 
}

func initializeARKit() async {
    print("ARKit initialization started")

    do {
        // åŒæ—¶è¿è¡Œä¸–ç•Œè·Ÿè¸ªå’Œæˆ¿é—´è·Ÿè¸ª
        try await session.run([worldTracking, roomTracking])
        print("ARKit session started with room tracking")
    } catch {
        print("ARKit session failed: \(error)")
    }
}
```

### æµ‹è¯•éªŒè¯
- æ§åˆ¶å°æ˜¾ç¤º "ARKit session started with room tracking"

### å­¦ä¹ é‡ç‚¹
- `RoomTrackingProvider` ç±»
- åŒæ—¶è¿è¡Œå¤šä¸ª provider
- visionOS æˆ¿é—´è·Ÿè¸ªèƒ½åŠ›

---

## è¿­ä»£ 25: æ·»åŠ æˆ¿é—´é”šç‚¹å­˜å‚¨

### ç›®æ ‡
å‡†å¤‡å­˜å‚¨æˆ¿é—´é”šç‚¹æ•°æ®

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `roomAnchors` å±æ€§
2. æ·»åŠ  `roomRoot` å®ä½“

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§

    let contentRoot = Entity()
    let roomRoot = Entity()  // æ–°å¢ï¼šæˆ¿é—´å†…å®¹æ ¹èŠ‚ç‚¹

    private(set) var sphereEntities: [UUID: ModelEntity] = [:]
    private var roomAnchors: [UUID: RoomAnchor] = [:]  // æ–°å¢

    // ... å…¶ä»–ä»£ç 
}

func setupContentEntity() {
    contentRoot.name = "ContentRoot"
    roomRoot.name = "RoomRoot"

    // å°† roomRoot æ·»åŠ åˆ° contentRoot
    contentRoot.addChild(roomRoot)

    print("Content entities setup complete")
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- æˆ¿é—´é”šç‚¹å­—å…¸
- å®ä½“å±‚çº§ç»„ç»‡

---

## è¿­ä»£ 26: ç›‘å¬æˆ¿é—´é”šç‚¹æ›´æ–°

### ç›®æ ‡
åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ç›‘å¬æˆ¿é—´å˜åŒ–

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `processRoomUpdates()` - å¤„ç†æˆ¿é—´æ›´æ–°

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
func initializeARKit() async {
    print("ARKit initialization started")

    do {
        try await session.run([worldTracking, roomTracking])
        print("ARKit session started with room tracking")

        // å¯åŠ¨æˆ¿é—´æ›´æ–°ç›‘å¬
        await processRoomUpdates()
    } catch {
        print("ARKit session failed: \(error)")
    }
}

private func processRoomUpdates() async {
    for await update in roomTracking.anchorUpdates {
        switch update.event {
        case .added:
            handleRoomAdded(update.anchor)
        case .updated:
            handleRoomUpdated(update.anchor)
        case .removed:
            handleRoomRemoved(update.anchor)
        }
    }
}

private func handleRoomAdded(_ anchor: RoomAnchor) {
    roomAnchors[anchor.id] = anchor
    print("Room added: \(anchor.id)")
}

private func handleRoomUpdated(_ anchor: RoomAnchor) {
    roomAnchors[anchor.id] = anchor
    print("Room updated: \(anchor.id)")
}

private func handleRoomRemoved(_ anchor: RoomAnchor) {
    roomAnchors.removeValue(forKey: anchor.id)
    print("Room removed: \(anchor.id)")
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´åï¼Œå¦‚æœç³»ç»Ÿæ£€æµ‹åˆ°æˆ¿é—´ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤º "Room added"

### å­¦ä¹ é‡ç‚¹
- `anchorUpdates` å¼‚æ­¥åºåˆ—
- é”šç‚¹äº‹ä»¶ï¼ˆadded/updated/removedï¼‰
- æˆ¿é—´é”šç‚¹ç”Ÿå‘½å‘¨æœŸ

---

## è¿­ä»£ 27: æ£€æµ‹çƒä½“æ˜¯å¦åœ¨å½“å‰æˆ¿é—´

### ç›®æ ‡
æ ¹æ®çƒä½“æ˜¯å¦åœ¨å½“å‰æˆ¿é—´æ”¹å˜é¢œè‰²

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `isSphereInCurrentRoom(_:)` - æ£€æŸ¥çƒä½“ä½ç½®

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
private func isSphereInCurrentRoom(
    position: SIMD3<Float>
) -> Bool {
    // è·å–å½“å‰æˆ¿é—´é”šç‚¹
    guard let currentRoom = roomTracking.currentRoomAnchor else {
        print("No current room")
        return false
    }

    // æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨æˆ¿é—´å†…
    let isInRoom = currentRoom.contains(position)
    print("Position \(position) in room: \(isInRoom)")
    return isInRoom
}
```

### æµ‹è¯•éªŒè¯
- æš‚æ—¶æ— æ³•ç›´æ¥æµ‹è¯•ï¼ˆéœ€è¦ä¸‹ä¸€è¿­ä»£åº”ç”¨ï¼‰

### å­¦ä¹ é‡ç‚¹
- `currentRoomAnchor` è·å–å½“å‰æˆ¿é—´
- `contains(_:)` ç©ºé—´åŒ…å«æµ‹è¯•
- æˆ¿é—´è¾¹ç•Œæ£€æµ‹

---

## è¿­ä»£ 28: æ ¹æ®æˆ¿é—´ä½ç½®æ”¹å˜çƒä½“é¢œè‰²

### ç›®æ ‡
å®ç°çƒä½“é¢œè‰²è‡ªåŠ¨å˜åŒ–ï¼ˆæˆ¿é—´å†…ç»¿è‰²ï¼Œæˆ¿é—´å¤–çº¢è‰²ï¼‰

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. ä¿®æ”¹ `addSphereAtPosition(_:)` - æ ¹æ®ä½ç½®è®¾ç½®é¢œè‰²
2. `updateSphereColors()` - æ›´æ–°æ‰€æœ‰çƒä½“é¢œè‰²
3. ä¿®æ”¹æˆ¿é—´æ›´æ–°å¤„ç† - è§¦å‘é¢œè‰²æ›´æ–°

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
func addSphereAtPosition(_ position: SIMD3<Float>) {
    let mesh = MeshResource.generateSphere(radius: 0.1)

    // æ ¹æ®æ˜¯å¦åœ¨æˆ¿é—´å†…é€‰æ‹©é¢œè‰²
    let isInRoom = isSphereInCurrentRoom(position: position)
    let color: UIColor = isInRoom ? .green : .red

    let material = SimpleMaterial(
        color: color,
        roughness: 0.2,
        isMetallic: true
    )

    let sphere = ModelEntity(mesh: mesh, materials: [material])
    sphere.position = position

    let id = UUID()
    sphere.name = "Sphere_\(id)"

    contentRoot.addChild(sphere)
    sphereEntities[id] = sphere

    print("Sphere placed at \(position), color: \(isInRoom ? "green" : "red")")
}

private func updateSphereColors() {
    for (_, sphere) in sphereEntities {
        let isInRoom = isSphereInCurrentRoom(position: sphere.position)
        let color: UIColor = isInRoom ? .green : .red

        let material = SimpleMaterial(
            color: color,
            roughness: 0.2,
            isMetallic: true
        )

        sphere.model?.materials = [material]
    }
    print("Sphere colors updated")
}

private func handleRoomUpdated(_ anchor: RoomAnchor) {
    roomAnchors[anchor.id] = anchor
    updateSphereColors()  // æˆ¿é—´æ›´æ–°æ—¶é‡æ–°è®¡ç®—é¢œè‰²
    print("Room updated: \(anchor.id)")
}
```

### æµ‹è¯•éªŒè¯
- åœ¨æ£€æµ‹åˆ°çš„æˆ¿é—´å†…æ”¾ç½®çƒä½“ï¼Œåº”ä¸ºç»¿è‰²
- ç§»åŠ¨åˆ°æˆ¿é—´å¤–ï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼Œçƒä½“å˜ä¸ºçº¢è‰²

### å­¦ä¹ é‡ç‚¹
- åŠ¨æ€æè´¨æ›´æ–°
- æˆ¿é—´è¾¹ç•Œæ„ŸçŸ¥
- å®ä½“å±æ€§ä¿®æ”¹

---

# é˜¶æ®µ6: é«˜çº§åŠŸèƒ½

## è¿­ä»£ 29: æ·»åŠ å¢™é¢å­˜å‚¨ç»“æ„

### ç›®æ ‡
ä¸ºå¢™é¢æ£€æµ‹å‡†å¤‡æ•°æ®ç»“æ„

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ å¢™é¢ç›¸å…³å±æ€§

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§

    let contentRoot = Entity()
    let roomRoot = Entity()
    let wallRoot = Entity()  // æ–°å¢ï¼šå¢™é¢æ ¹èŠ‚ç‚¹

    private(set) var sphereEntities: [UUID: ModelEntity] = [:]
    private var roomAnchors: [UUID: RoomAnchor] = [:]
    private var wallEntities: [String: ModelEntity] = [:]  // æ–°å¢

    // ... å…¶ä»–ä»£ç 
}

func setupContentEntity() {
    contentRoot.name = "ContentRoot"
    roomRoot.name = "RoomRoot"
    wallRoot.name = "WallRoot"

    contentRoot.addChild(roomRoot)
    contentRoot.addChild(wallRoot)

    print("Content entities setup complete")
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- å¢™é¢å®ä½“ç»„ç»‡
- å¤šå±‚çº§å®ä½“ç»“æ„

---

## è¿­ä»£ 30: æå–æˆ¿é—´å¢™é¢å‡ ä½•

### ç›®æ ‡
ä»æˆ¿é—´é”šç‚¹ä¸­æå–å¢™é¢å‡ ä½•æ•°æ®

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. `extractWalls(from:)` - æå–å¢™é¢

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
private func extractWalls(from roomAnchor: RoomAnchor) {
    // æ¸…é™¤æ—§å¢™é¢
    for (_, wall) in wallEntities {
        wall.removeFromParent()
    }
    wallEntities.removeAll()

    // è·å–å¢™é¢å‡ ä½•
    let walls = roomAnchor.geometries(classifiedAs: .wall)

    print("Found \(walls.count) walls in room")

    for (index, wall) in walls.enumerated() {
        createWallEntity(
            from: wall,
            index: index,
            roomAnchor: roomAnchor
        )
    }
}

private func createWallEntity(
    from geometry: MeshAnchor.Geometry,
    index: Int,
    roomAnchor: RoomAnchor
) {
    // ä¸‹ä¸€è¿­ä»£å®ç°
    print("Wall \(index) detected")
}
```

### æµ‹è¯•éªŒè¯
- å½“æ£€æµ‹åˆ°æˆ¿é—´æ—¶ï¼Œæ§åˆ¶å°æ˜¾ç¤ºå¢™é¢æ•°é‡

### å­¦ä¹ é‡ç‚¹
- `geometries(classifiedAs:)` åˆ†ç±»å‡ ä½•
- `.wall` åˆ†ç±»
- MeshAnchor.Geometry ç±»å‹

---

## è¿­ä»£ 31: å°†å¢™é¢å‡ ä½•è½¬æ¢ä¸ºç½‘æ ¼èµ„æº

### ç›®æ ‡
åˆ›å»ºè¾…åŠ©æ–¹æ³•å°† ARKit å‡ ä½•è½¬æ¢ä¸º RealityKit ç½‘æ ¼

### æ–°å»ºæ–‡ä»¶
- `Extensions.swift`

### æ–¹æ³•åˆ—è¡¨
1. `MeshAnchor.Geometry.asMeshResource()` æ‰©å±•æ–¹æ³•

### ä»£ç è¦ç‚¹

**Extensions.swift**:
```swift
import ARKit
import RealityKit

extension MeshAnchor.Geometry {
    @MainActor
    func asMeshResource() -> MeshResource? {
        // è·å–é¡¶ç‚¹æ•°æ®
        let vertices = self.vertices.asSIMD3(ofType: Float.self)

        // è·å–é¢ç´¢å¼•
        let faces = self.faces.asIndexArray()

        // åˆ›å»ºç½‘æ ¼æè¿°ç¬¦
        var descriptor = MeshDescriptor()
        descriptor.positions = .init(vertices)
        descriptor.primitives = .triangles(faces)

        // ç”Ÿæˆç½‘æ ¼èµ„æº
        do {
            let mesh = try MeshResource.generate(from: [descriptor])
            return mesh
        } catch {
            print("Failed to generate mesh: \(error)")
            return nil
        }
    }
}

// è¾…åŠ©æ‰©å±•
extension GeometrySource {
    func asSIMD3<T>(ofType: T.Type) -> [SIMD3<T>] {
        var result: [SIMD3<T>] = []
        for i in 0..<count {
            let data = buffer.contents() + offset + (stride * i)
            let value = data.assumingMemoryBound(to: SIMD3<T>.self).pointee
            result.append(value)
        }
        return result
    }
}

extension GeometryElement {
    func asIndexArray() -> [UInt32] {
        var result: [UInt32] = []
        let indexCount = count * indexCountPerPrimitive

        for i in 0..<indexCount {
            let data = buffer.contents() + (i * bytesPerIndex)
            let index = data.assumingMemoryBound(to: UInt32.self).pointee
            result.append(index)
        }
        return result
    }
}
```

### æµ‹è¯•éªŒè¯
- ä»£ç ç¼–è¯‘æ— é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- ARKit å‡ ä½•æ•°æ®ç»“æ„
- RealityKit MeshDescriptor
- é¡¶ç‚¹å’Œç´¢å¼•æ•°æ®è½¬æ¢
- Swift å†…å­˜æ“ä½œ

---

## è¿­ä»£ 32: åˆ›å»ºå¢™é¢å®ä½“å¹¶æ¸²æŸ“

### ç›®æ ‡
å°†å¢™é¢å‡ ä½•è½¬æ¢ä¸ºå¯è§†åŒ–å®ä½“

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. å®ç° `createWallEntity(from:index:roomAnchor:)``

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
private func createWallEntity(
    from geometry: MeshAnchor.Geometry,
    index: Int,
    roomAnchor: RoomAnchor
) {
    // è½¬æ¢ä¸ºç½‘æ ¼èµ„æº
    guard let meshResource = geometry.asMeshResource() else {
        print("Failed to convert wall geometry")
        return
    }

    // åˆ›å»ºåŠé€æ˜è“è‰²æè´¨
    var material = UnlitMaterial()
    material.color = .init(tint: .blue.withAlphaComponent(0.3))

    // åˆ›å»ºå®ä½“
    let wallEntity = ModelEntity(
        mesh: meshResource,
        materials: [material]
    )
    wallEntity.name = "Wall_\(index)"

    // åº”ç”¨æˆ¿é—´é”šç‚¹çš„å˜æ¢
    wallEntity.transform = Transform(matrix: roomAnchor.originFromAnchorTransform)

    // æ·»åŠ åˆ°åœºæ™¯
    wallRoot.addChild(wallEntity)
    wallEntities["Wall_\(index)"] = wallEntity

    print("Wall \(index) entity created")
}
```

### æµ‹è¯•éªŒè¯
- åœ¨æˆ¿é—´ä¸­ï¼Œåº”è¯¥çœ‹åˆ°åŠé€æ˜è“è‰²çš„å¢™é¢è½®å»“

### å­¦ä¹ é‡ç‚¹
- `UnlitMaterial` æ— å…‰ç…§æè´¨
- åŠé€æ˜æè´¨
- å˜æ¢çŸ©é˜µåº”ç”¨
- å¢™é¢å¯è§†åŒ–

---

## è¿­ä»£ 33: æ·»åŠ å¢™é¢å¯è§†åŒ–æ¨¡å¼

### ç›®æ ‡
æ·»åŠ UIæ§åˆ¶å¢™é¢æ˜¾ç¤º/éšè—

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `showWalls` å±æ€§
2. `toggleWallVisibility()` - åˆ‡æ¢å¢™é¢æ˜¾ç¤º

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    var isImmersive = false
    var showPreviewSphere = false
    var showWalls = false  // æ–°å¢

    // ... å…¶ä»–ä»£ç 
}

func toggleWallVisibility() {
    showWalls.toggle()
    wallRoot.isEnabled = showWalls
    print("Walls visible: \(showWalls)")
}
```

**ContentView.swift**:
```swift
VStack(spacing: 15) {
    Button(appState.showPreviewSphere ? "å–æ¶ˆæ”¾ç½®" : "æ·»åŠ çƒä½“") {
        appState.showPreviewSphere.toggle()
    }
    .buttonStyle(.borderedProminent)

    // æ–°å¢ï¼šå¢™é¢æ˜¾ç¤ºåˆ‡æ¢
    Button(appState.showWalls ? "éšè—å¢™é¢" : "æ˜¾ç¤ºå¢™é¢") {
        appState.toggleWallVisibility()
    }
    .buttonStyle(.bordered)

    Button("åˆ é™¤æ‰€æœ‰çƒä½“") {
        appState.removeAllSpheres()
    }
    .buttonStyle(.bordered)
    .disabled(appState.sphereEntities.isEmpty)

    Button("é€€å‡ºæ²‰æµ¸å¼ç©ºé—´") {
        Task { await closeImmersiveSpace() }
    }
    .buttonStyle(.bordered)
}
```

### æµ‹è¯•éªŒè¯
- ç‚¹å‡»"æ˜¾ç¤ºå¢™é¢"æŒ‰é’®ï¼Œå¢™é¢è½®å»“å‡ºç°
- ç‚¹å‡»"éšè—å¢™é¢"ï¼Œå¢™é¢è½®å»“æ¶ˆå¤±

### å­¦ä¹ é‡ç‚¹
- å®ä½“æ ‘çš„æ‰¹é‡æ˜¾ç¤º/éšè—
- UI çŠ¶æ€åŒæ­¥

---

## è¿­ä»£ 34: æ·»åŠ é®æŒ¡æè´¨æ¨¡å¼

### ç›®æ ‡
å®ç°é®æŒ¡å¯è§†åŒ–ï¼Œéšè—æˆ¿é—´å¤–çš„ç‰©ä½“

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `VisualizationMode` æšä¸¾
2. `setVisualizationMode(_:)` - è®¾ç½®å¯è§†åŒ–æ¨¡å¼
3. ä¿®æ”¹å¢™é¢åˆ›å»ºé€»è¾‘

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
enum VisualizationMode {
    case none      // ä¸æ˜¾ç¤º
    case walls     // æ˜¾ç¤ºå¢™é¢
    case occlusion // é®æŒ¡æ¨¡å¼
}

@Observable
@MainActor
class AppState {
    var isImmersive = false
    var showPreviewSphere = false
    var visualizationMode: VisualizationMode = .none  // ä¿®æ”¹

    // ... å…¶ä»–ä»£ç 
}

func setVisualizationMode(_ mode: VisualizationMode) {
    visualizationMode = mode

    switch mode {
    case .none:
        roomRoot.isEnabled = false
        wallRoot.isEnabled = false
    case .walls:
        roomRoot.isEnabled = false
        wallRoot.isEnabled = true
    case .occlusion:
        roomRoot.isEnabled = true
        wallRoot.isEnabled = false
    }

    print("Visualization mode: \(mode)")
}
```

**ä¿®æ”¹æˆ¿é—´å¤„ç†**:
```swift
private func handleRoomAdded(_ anchor: RoomAnchor) {
    roomAnchors[anchor.id] = anchor
    extractWalls(from: anchor)

    // åˆ›å»ºé®æŒ¡å®ä½“
    if anchor.isCurrentRoom {
        createOcclusionEntity(from: anchor)
    }

    print("Room added: \(anchor.id)")
}

private func createOcclusionEntity(from roomAnchor: RoomAnchor) {
    // ç®€åŒ–ç‰ˆï¼šä½¿ç”¨æˆ¿é—´çš„æ•´ä½“å‡ ä½•
    // å®é™…åº”è¯¥åˆå¹¶æ‰€æœ‰å¢™é¢å‡ ä½•
    let occlusionMaterial = OcclusionMaterial()

    // åç»­å¯ä»¥åˆ›å»ºå®Œæ•´çš„æˆ¿é—´é®æŒ¡ç½‘æ ¼
    print("Occlusion entity created for room")
}
```

### æµ‹è¯•éªŒè¯
- åˆ‡æ¢ä¸åŒçš„å¯è§†åŒ–æ¨¡å¼

### å­¦ä¹ é‡ç‚¹
- æšä¸¾ç±»å‹å®šä¹‰
- `OcclusionMaterial` é®æŒ¡æè´¨
- æ¨¡å¼åˆ‡æ¢é€»è¾‘

---

## è¿­ä»£ 35: æ·»åŠ å¯è§†åŒ–æ¨¡å¼é€‰æ‹©å™¨

### ç›®æ ‡
åœ¨ UI ä¸­æ·»åŠ æ¨¡å¼é€‰æ‹©å™¨

### ä¿®æ”¹æ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  Picker æ§ä»¶

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
VStack(spacing: 15) {
    Button(appState.showPreviewSphere ? "å–æ¶ˆæ”¾ç½®" : "æ·»åŠ çƒä½“") {
        appState.showPreviewSphere.toggle()
    }
    .buttonStyle(.borderedProminent)

    // æ–°å¢ï¼šå¯è§†åŒ–æ¨¡å¼é€‰æ‹©å™¨
    Picker("å¯è§†åŒ–æ¨¡å¼", selection: Binding(
        get: { appState.visualizationMode },
        set: { appState.setVisualizationMode($0) }
    )) {
        Text("æ— ").tag(AppState.VisualizationMode.none)
        Text("å¢™é¢").tag(AppState.VisualizationMode.walls)
        Text("é®æŒ¡").tag(AppState.VisualizationMode.occlusion)
    }
    .pickerStyle(.segmented)

    Button("åˆ é™¤æ‰€æœ‰çƒä½“") {
        appState.removeAllSpheres()
    }
    .buttonStyle(.bordered)
    .disabled(appState.sphereEntities.isEmpty)

    Button("é€€å‡ºæ²‰æµ¸å¼ç©ºé—´") {
        Task { await closeImmersiveSpace() }
    }
    .buttonStyle(.bordered)
}
```

### æµ‹è¯•éªŒè¯
- ä½¿ç”¨åˆ†æ®µé€‰æ‹©å™¨åˆ‡æ¢ä¸åŒå¯è§†åŒ–æ¨¡å¼

### å­¦ä¹ é‡ç‚¹
- SwiftUI Picker æ§ä»¶
- `.segmented` æ ·å¼
- Binding åŒå‘ç»‘å®š

---

# é˜¶æ®µ7: ä¼˜åŒ–ä¸å®Œå–„

## è¿­ä»£ 36: æ·»åŠ é”™è¯¯å¤„ç†çŠ¶æ€

### ç›®æ ‡
æ·»åŠ å®Œå–„çš„é”™è¯¯å¤„ç†

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `ErrorState` æšä¸¾
2. `checkAuthorization()` - æ£€æŸ¥æƒé™

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
enum ErrorState: Equatable {
    case none
    case notSupported
    case notAuthorized
    case sessionError(String)
}

@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§
    var errorState: ErrorState = .none

    // ... å…¶ä»–ä»£ç 
}

private func checkAuthorization() async -> Bool {
    let authorization = await ARKitSession().queryAuthorization(
        for: [.worldSensing]
    )

    if authorization[.worldSensing] == .denied {
        errorState = .notAuthorized
        return false
    }

    return true
}

func initializeARKit() async {
    print("ARKit initialization started")

    // æ£€æŸ¥æƒé™
    guard await checkAuthorization() else {
        print("Authorization denied")
        return
    }

    // æ£€æŸ¥æ”¯æŒæ€§
    guard WorldTrackingProvider.isSupported,
          RoomTrackingProvider.isSupported else {
        errorState = .notSupported
        print("Tracking not supported")
        return
    }

    do {
        try await session.run([worldTracking, roomTracking])
        errorState = .none
        print("ARKit session started successfully")

        await processRoomUpdates()
    } catch {
        errorState = .sessionError(error.localizedDescription)
        print("ARKit session failed: \(error)")
    }
}
```

### æµ‹è¯•éªŒè¯
- åœ¨ä¸æ”¯æŒçš„è®¾å¤‡ä¸Šï¼Œæ˜¾ç¤ºç›¸åº”é”™è¯¯

### å­¦ä¹ é‡ç‚¹
- æƒé™æŸ¥è¯¢
- åŠŸèƒ½æ”¯æŒæ€§æ£€æŸ¥
- é”™è¯¯çŠ¶æ€ç®¡ç†

---

## è¿­ä»£ 37: æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### ç›®æ ‡
åœ¨ UI ä¸­æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### ä¿®æ”¹æ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ é”™è¯¯è§†å›¾

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
var body: some View {
    VStack(spacing: 20) {
        Text("æˆ¿é—´è®¾è®¡å™¨")
            .font(.largeTitle)

        // é”™è¯¯ä¿¡æ¯æ˜¾ç¤º
        if appState.errorState != .none {
            errorView
        }

        // å…¶ä»–æ§ä»¶...
    }
    .padding()
}

@ViewBuilder
private var errorView: some View {
    VStack(spacing: 10) {
        Image(systemName: "exclamationmark.triangle.fill")
            .font(.largeTitle)
            .foregroundStyle(.red)

        switch appState.errorState {
        case .none:
            EmptyView()
        case .notSupported:
            Text("è®¾å¤‡ä¸æ”¯æŒæˆ¿é—´è·Ÿè¸ª")
        case .notAuthorized:
            Text("éœ€è¦ä¸–ç•Œæ„ŸçŸ¥æƒé™")
        case .sessionError(let message):
            Text("ä¼šè¯é”™è¯¯: \(message)")
        }
    }
    .padding()
    .background(.red.opacity(0.1))
    .cornerRadius(10)
}
```

### æµ‹è¯•éªŒè¯
- æ¨¡æ‹Ÿé”™è¯¯çŠ¶æ€ï¼ŒæŸ¥çœ‹é”™è¯¯æ˜¾ç¤º

### å­¦ä¹ é‡ç‚¹
- `@ViewBuilder` æ„å»ºå™¨
- switch è¡¨è¾¾å¼åŒ¹é…
- æ¡ä»¶è§†å›¾æ¸²æŸ“

---

## è¿­ä»£ 38: æ·»åŠ åŠ è½½çŠ¶æ€

### ç›®æ ‡
æ˜¾ç¤º ARKit åˆå§‹åŒ–è¿›åº¦

### ä¿®æ”¹æ–‡ä»¶
- `AppState.swift`
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ  `isInitializing` å±æ€§
2. æ·»åŠ åŠ è½½æŒ‡ç¤ºå™¨

### ä»£ç è¦ç‚¹

**AppState.swift**:
```swift
@Observable
@MainActor
class AppState {
    // ... å…¶ä»–å±æ€§
    var isInitializing = false

    // ... å…¶ä»–ä»£ç 
}

func initializeARKit() async {
    isInitializing = true
    defer { isInitializing = false }

    print("ARKit initialization started")

    // ... ç°æœ‰åˆå§‹åŒ–ä»£ç 
}
```

**ContentView.swift**:
```swift
if !appState.isImmersive {
    Button("è¿›å…¥æ²‰æµ¸å¼ç©ºé—´") {
        Task { await openImmersiveSpace() }
    }
    .buttonStyle(.borderedProminent)
} else {
    if appState.isInitializing {
        ProgressView("åˆå§‹åŒ–ä¸­...")
    } else {
        // ç°æœ‰æ§ä»¶
    }
}
```

### æµ‹è¯•éªŒè¯
- è¿›å…¥æ²‰æµ¸å¼ç©ºé—´æ—¶ï¼ŒçŸ­æš‚æ˜¾ç¤º"åˆå§‹åŒ–ä¸­..."

### å­¦ä¹ é‡ç‚¹
- `defer` è¯­å¥
- `ProgressView` æ§ä»¶
- åŠ è½½çŠ¶æ€ç®¡ç†

---

## è¿­ä»£ 39: æ·»åŠ çƒä½“è®¡æ•°æ˜¾ç¤º

### ç›®æ ‡
æ˜¾ç¤ºå½“å‰æ”¾ç½®çš„çƒä½“æ•°é‡

### ä¿®æ”¹æ–‡ä»¶
- `ContentView.swift`

### æ–¹æ³•åˆ—è¡¨
1. æ·»åŠ è®¡æ•°æ˜¾ç¤º

### ä»£ç è¦ç‚¹

**ContentView.swift**:
```swift
VStack(spacing: 15) {
    // çƒä½“è®¡æ•°
    HStack {
        Text("å·²æ”¾ç½®çƒä½“:")
        Text("\(appState.sphereEntities.count)")
            .bold()
            .foregroundStyle(.blue)
    }
    .font(.headline)

    // å…¶ä»–æ§ä»¶...
}
```

### æµ‹è¯•éªŒè¯
- æ”¾ç½®çƒä½“åï¼Œè®¡æ•°å¢åŠ 
- åˆ é™¤æ‰€æœ‰çƒä½“åï¼Œè®¡æ•°å½’é›¶

### å­¦ä¹ é‡ç‚¹
- æ•°æ®é©±åŠ¨ UI
- è®¡ç®—å±æ€§æ˜¾ç¤º

---

## è¿­ä»£ 40: æ·»åŠ ä½¿ç”¨è¯´æ˜

### ç›®æ ‡
åˆ›å»ºç®€å•çš„ä½¿ç”¨æŒ‡å—æ–‡æ¡£

### æ–°å»ºæ–‡ä»¶
- `ä½¿ç”¨æŒ‡å—.md`

### æ–¹æ³•åˆ—è¡¨
æ— ï¼ˆæ–‡æ¡£ï¼‰

### ä»£ç è¦ç‚¹

**ä½¿ç”¨æŒ‡å—.md**:
```markdown
# æˆ¿é—´è®¾è®¡å™¨ - ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ª visionOS ç©ºé—´è®¾è®¡åº”ç”¨ï¼Œå¯ä»¥ï¼š
- æ‰«æå’Œè¯†åˆ«æˆ¿é—´
- åœ¨ç©ºé—´ä¸­æ”¾ç½® 3D ç‰©ä½“
- æŸ¥çœ‹å¢™é¢å’Œæˆ¿é—´è¾¹ç•Œ
- åŒºåˆ†æˆ¿é—´å†…å¤–çš„ç‰©ä½“

## ä½¿ç”¨æ­¥éª¤

### 1. å¯åŠ¨åº”ç”¨
- è¿è¡Œåº”ç”¨åï¼Œä¼šçœ‹åˆ°ä¸»çª—å£

### 2. è¿›å…¥æ²‰æµ¸å¼ç©ºé—´
- ç‚¹å‡»"è¿›å…¥æ²‰æµ¸å¼ç©ºé—´"æŒ‰é’®
- ç­‰å¾… ARKit åˆå§‹åŒ–å®Œæˆ

### 3. æ”¾ç½®çƒä½“
- ç‚¹å‡»"æ·»åŠ çƒä½“"æŒ‰é’®
- åŠé€æ˜é¢„è§ˆçƒä½“ä¼šå‡ºç°åœ¨è§†é‡å‰æ–¹
- ç§»åŠ¨å¤´éƒ¨è°ƒæ•´ä½ç½®
- ç”¨æ‰‹æŒ‡åš pinch æ‰‹åŠ¿ç‚¹å‡»é¢„è§ˆçƒä½“
- çƒä½“ä¼šè¢«æ”¾ç½®åœ¨è¯¥ä½ç½®

### 4. ç†è§£çƒä½“é¢œè‰²
- ç»¿è‰²çƒä½“ï¼šåœ¨å½“å‰æ£€æµ‹åˆ°çš„æˆ¿é—´å†…
- çº¢è‰²çƒä½“ï¼šåœ¨æˆ¿é—´å¤–æˆ–æœªæ£€æµ‹åˆ°æˆ¿é—´

### 5. æŸ¥çœ‹å¢™é¢
- ä½¿ç”¨å¯è§†åŒ–æ¨¡å¼é€‰æ‹©å™¨ï¼š
  - **æ— **ï¼šä¸æ˜¾ç¤ºä»»ä½•æˆ¿é—´å¯è§†åŒ–
  - **å¢™é¢**ï¼šæ˜¾ç¤ºåŠé€æ˜è“è‰²å¢™é¢è½®å»“
  - **é®æŒ¡**ï¼šä½¿ç”¨é®æŒ¡æè´¨ï¼ˆæˆ¿é—´å¤–ç‰©ä½“è¢«éšè—ï¼‰

### 6. åˆ é™¤çƒä½“
- ç‚¹å‡»"åˆ é™¤æ‰€æœ‰çƒä½“"æ¸…é™¤æ‰€æœ‰æ”¾ç½®çš„ç‰©ä½“

### 7. é€€å‡º
- ç‚¹å‡»"é€€å‡ºæ²‰æµ¸å¼ç©ºé—´"è¿”å›çª—å£æ¨¡å¼

## æ³¨æ„äº‹é¡¹

- éœ€è¦æˆäºˆä¸–ç•Œæ„ŸçŸ¥æƒé™
- æˆ¿é—´æ£€æµ‹éœ€è¦ä¸€å®šæ—¶é—´
- åœ¨å…‰çº¿å……è¶³çš„ç¯å¢ƒä¸­æ•ˆæœæ›´å¥½
- ç§»åŠ¨è®¾å¤‡å¯ä»¥å¸®åŠ©ç³»ç»Ÿæ›´å¥½åœ°ç†è§£ç©ºé—´

## æŠ€æœ¯è¦æ±‚

- visionOS 1.0+
- Vision Pro è®¾å¤‡
- ä¸–ç•Œæ„ŸçŸ¥æƒé™
```

### æµ‹è¯•éªŒè¯
- é˜…è¯»æ–‡æ¡£ï¼Œç¡®ä¿è¯´æ˜æ¸…æ™°

### å­¦ä¹ é‡ç‚¹
- ç”¨æˆ·æ–‡æ¡£ç¼–å†™
- åŠŸèƒ½è¯´æ˜

---

# æ€»ç»“ä¸ä¸‹ä¸€æ­¥

## å®Œæˆçš„åŠŸèƒ½

ç»è¿‡ 40 ä¸ªè¿­ä»£ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

âœ… visionOS åº”ç”¨åŸºç¡€æ¶æ„
âœ… SwiftUI çª—å£å’Œæ²‰æµ¸å¼ç©ºé—´
âœ… RealityKit 3D å†…å®¹æ¸²æŸ“
âœ… ARKit ä¸–ç•Œè·Ÿè¸ª
âœ… ARKit æˆ¿é—´è·Ÿè¸ª
âœ… ç©ºé—´æ‰‹åŠ¿äº¤äº’
âœ… 3D ç‰©ä½“æ”¾ç½®
âœ… æˆ¿é—´è¾¹ç•Œæ£€æµ‹
âœ… å¢™é¢å¯è§†åŒ–
âœ… é®æŒ¡æè´¨åº”ç”¨
âœ… é”™è¯¯å¤„ç†
âœ… å®Œæ•´çš„ UI æ§åˆ¶

## å­¦åˆ°çš„æŠ€æœ¯

### visionOS ä¸“æœ‰
- ImmersiveSpace
- RealityView
- AnchorEntity(.head)
- SpatialTapGesture

### ARKit for visionOS
- ARKitSession
- WorldTrackingProvider
- RoomTrackingProvider
- WorldAnchor / RoomAnchor

### RealityKit
- Entity å±‚çº§
- ModelEntity
- MeshResource
- SimpleMaterial / OcclusionMaterial / UnlitMaterial
- Component ç³»ç»Ÿ

### SwiftUI
- @Observable
- @Environment
- å¼‚æ­¥æ“ä½œ
- çŠ¶æ€ç®¡ç†

## å¯é€‰çš„åç»­è¿­ä»£

å¦‚æœæƒ³ç»§ç»­æ·±å…¥ï¼Œå¯ä»¥æ·»åŠ ï¼š

### åŠŸèƒ½æ‰©å±•
- ç‰©ä½“ç§»åŠ¨ï¼ˆæ‹–æ‹½æ‰‹åŠ¿ï¼‰
- ç‰©ä½“ç¼©æ”¾å’Œæ—‹è½¬
- ä¸åŒç±»å‹çš„ 3D æ¨¡å‹
- ç‰©ä½“ä¿å­˜å’ŒåŠ è½½ï¼ˆæŒä¹…åŒ–ï¼‰
- å¤šç”¨æˆ·åä½œ
- ç‰©ä½“å¸é™„åˆ°å¢™é¢

### äº¤äº’ä¼˜åŒ–
- æ‰‹éƒ¨è·Ÿè¸ª
- çœ¼åŠ¨è¿½è¸ªé€‰æ‹©
- è¯­éŸ³å‘½ä»¤
- æ›´ä¸°å¯Œçš„æ‰‹åŠ¿

### è§†è§‰ä¼˜åŒ–
- æ›´ç²¾ç»†çš„æè´¨
- å…‰ç…§å’Œé˜´å½±
- ç²’å­æ•ˆæœ
- åŠ¨ç”»

## å»ºè®®çš„å­¦ä¹ è·¯å¾„

å¦‚æœä½ æ˜¯ visionOS æ–°æ‰‹ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºå­¦ä¹ ï¼š

1. **åŸºç¡€è¿­ä»£ï¼ˆ1-6ï¼‰**: ç†è§£åº”ç”¨æ¶æ„
2. **3D å†…å®¹ï¼ˆ7-12ï¼‰**: RealityKit åŸºç¡€
3. **ARKit é›†æˆï¼ˆ13-16ï¼‰**: ç©ºé—´è·Ÿè¸ª
4. **äº¤äº’ï¼ˆ17-23ï¼‰**: æ‰‹åŠ¿å’Œæ”¾ç½®
5. **æˆ¿é—´è·Ÿè¸ªï¼ˆ24-28ï¼‰**: é«˜çº§ ARKit
6. **å¯è§†åŒ–ï¼ˆ29-35ï¼‰**: å¢™é¢å’Œé®æŒ¡
7. **å®Œå–„ï¼ˆ36-40ï¼‰**: é”™è¯¯å¤„ç†å’Œä¼˜åŒ–

æ¯å®Œæˆä¸€ä¸ªé˜¶æ®µï¼Œç¡®ä¿ï¼š
- è¿è¡Œå¹¶æµ‹è¯•ä»£ç 
- ç†è§£æ¯ä¸€è¡Œä»£ç 
- èƒ½è§£é‡ŠèƒŒåçš„åŸç†
- å°è¯•å°çš„å˜åŒ–å’Œå®éªŒ

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-10-27
**ç‰ˆæœ¬**: 1.0
**è¿­ä»£æ€»æ•°**: 40
**é¢„è®¡å­¦ä¹ æ—¶é—´**: 20-30 å°æ—¶ï¼ˆå–å†³äºç°æœ‰ç»éªŒï¼‰
